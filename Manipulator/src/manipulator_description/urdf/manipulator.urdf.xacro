<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="manipulator">

    <xacro:include filename="$(find manipulator_description)/urdf/manipulator_gazebo.xacro"/>
    <xacro:include filename="$(find manipulator_description)/urdf/manipulator_ros2_control.xacro"/>

    <!-- Links -->
    <link name="world"/>

    <link name="base_plate">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.050"/>  <!-- Example: 50g plate -->
            <inertia 
                ixx="0.00001129" 
                ixy="0.0" 
                ixz="0.0"
                iyy="0.00001129" 
                iyz="0.0"
                izz="0.00002250"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.03" length="0.005"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.03" length="0.005"/>
            </geometry>
        </collision>
    </link>


    <joint name="base_plate_fixed" type="fixed">
        <parent link="world"/>
        <child link="base_plate"/>
        <origin xyz="0 0 0.5" rpy="0 0 0"/>  <!-- Raised whole model +0.5 m along Z -->
    </joint>


    <link name="motor_1">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.075"/>

            <inertia 
                ixx="1.512500e-05" ixy="0" ixz="0"
                iyy="2.475625e-05" iyz="0"
                izz="1.568125e-05"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <!-- Motor approximated as 45×22×44 mm box -->
                <box size="0.045 0.022 0.044"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.045 0.022 0.044"/>
            </geometry>
        </collision>
    </link>

    <joint name="joint_motor_1" type="fixed">
        <parent link="base_plate"/>
        <child link="motor_1"/>

        <!-- Motor attached below the plate -->
        <origin xyz="0 0 -0.0245" rpy="0 0 0"/>
    </joint>


    <link name="razor_connector">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.01"/>

            <inertia 
                ixx="1.28958333e-07" ixy="0" ixz="0"
                iyy="1.28958333e-07" iyz="0"
                izz="1.51250000e-07"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.0055" length="0.008"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.0055" length="0.008"/>
            </geometry>
        </collision>
    </link>

    <joint name="joint_motor1_to_connector" type="fixed">
        <parent link="motor_1"/>
        <child link="razor_connector"/>

        <!-- Connector sits ABOVE motor_1 -->
        <origin xyz="0.0095 0 -0.026" rpy="0 0 0"/>
    </joint>


    <link name="motor_2">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.082"/>

            <inertia
                ixx="2.10193333e-05" ixy="0" ixz="0"
                iyy="2.31308333e-05" iyz="0"
                izz="3.62781667e-05"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <!-- Motor approximated as 53×24×50 mm box -->
                <box size="0.053 0.050 0.024"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.053 0.050 0.024"/>
            </geometry>
        </collision>
    </link>

    <joint name="joint_1" type="revolute">
        <parent link="razor_connector"/>
        <child link="motor_2"/>

        <!-- Motor 2 sits ABOVE the connector -->
        <origin xyz="0 -0.010 -0.016" rpy="0 0 0"/>

        <!-- Rotation around Z-axis -->
        <axis xyz="0 0 1"/>

        <!-- Reasonable limits (modify as needed) -->
        <limit lower="-3.14" upper="3.14" effort="2.0" velocity="5.0"/>
    </joint>

    <link name="h_arm">
        <inertial>
            <origin xyz="0 0 -0.052" rpy="0 0 0"/>
            <mass value="0.054"/>

            <inertia
                ixx="1.980045e-04" ixy="0" ixz="0"
                iyy="2.266425e-04" iyz="0"
                izz="3.426300e-05"/>
        </inertial>

        <visual>
            <origin xyz="0 0 -0.052" rpy="0 0 0"/>
            <geometry>
                <!-- 2 mm × 25 mm cross-section, height 128 mm -->
                <box size="0.057 0.025 0.128"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 -0.052" rpy="0 0 0"/>
            <geometry>
                <box size="0.057 0.025 0.128"/>
            </geometry>
        </collision>
    </link>
   
    <joint name="joint_2" type="revolute">
        <parent link="motor_2"/>
        <child link="h_arm"/>

        <!-- Arm sits Below motor_2 -->
        <origin xyz="0 0.0125 0" rpy="0 0 0"/>

        <!-- Rotation around X-axis -->
        <axis xyz="1 0 0"/>

        <limit lower="-1.57" upper="1.57" effort="2.0" velocity="3.0"/>
    </joint>



    <link name="motor_3">
        <inertial>
            <origin xyz="0 0 -0.015" rpy="0 0 0"/>
            <mass value="0.085"/>

            <inertia 
                ixx="4.90520833e-05" ixy="0" ixz="0"
                iyy="6.45220833e-05" iyz="0"
                izz="2.43241667e-05"/>
        </inertial>

        <visual>
            <origin xyz="0 0 -0.015" rpy="0 0 0"/>
            <geometry>
                <!-- 53 × 25 × 60 mm -->
                <box size="0.053 0.025 0.060"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 -0.015" rpy="0 0 0"/>
            <geometry>
                <box size="0.053 0.025 0.060"/>
            </geometry>
        </collision>
    </link>
    
    <joint name="joint_3" type="revolute">
        <parent link="h_arm"/>
        <child link="motor_3"/>
        
        <origin xyz="0 0 -0.106" rpy="0 0 0"/>
        <!-- Rotation around X-axis -->
        <axis xyz="1 0 0"/>
        <limit lower="-1.57" upper="1.57" effort="2.0" velocity="3.0"/>
    </joint>


    <link name="rod">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.02"/>

            <inertia
                ixx="5.22166667e-06" ixy="0" ixz="0"
                iyy="5.22166667e-06" iyz="0"
                izz="3.60000000e-07"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <!-- r = 6 mm, h = 55 mm -->
                <cylinder radius="0.006" length="0.055"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.006" length="0.055"/>
            </geometry>
        </collision>
    </link>

    <!-- Rod fixedly connected to Motor 3 -->
    <joint name="joint_motor3_to_rod" type="fixed">
        <parent link="motor_3"/>
        <child  link="rod"/>

        <!-- Rod center 0.0575 m above motor_3 center:
            0.5*0.060 (motor height) + 0.5*0.055 (rod length) -->
        <origin xyz="-0.0015 0 -0.0725" rpy="0 0 0"/>
    </joint>


    <link name="gripper_base">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.020"/>

            <inertia
                ixx="4.18166667e-06" ixy="0" ixz="0"
                iyy="6.83333333e-06" iyz="0"
                izz="2.68166667e-06"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <!-- 40 × 3 × 50 mm plate -->
                <box size="0.040 0.003 0.050"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.040 0.003 0.050"/>
            </geometry>
        </collision>
    </link>

    <joint name="joint_rod_to_gripper_base" type="fixed">
        <parent link="rod"/>
        <child  link="gripper_base"/>

        <!-- Gripper base mounted at the top end of the rod -->
        <origin xyz="0 0 -0.0525" rpy="0 0 0"/>
    </joint>


    <link name="motor_4">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.055"/>

            <inertia
                ixx="1.11145833e-05" ixy="0" ixz="0"
                iyy="1.07066667e-05" iyz="0"
                izz="1.81545833e-05"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <!-- 44 × 20 × 45 mm block -->
                <box size="0.044 0.045 0.020"/>
            </geometry>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.044 0.045 0.020"/>
            </geometry>
        </collision>
    </link>

    <joint name="joint_gripperbase_to_motor4" type="fixed">
        <parent link="gripper_base"/>
        <child  link="motor_4"/>

        <!-- Motor 4 mounted on top of the gripper base -->
        <origin xyz="0.027 -0.024 -0.002" rpy="0 0 0"/>
    </joint>


    <link name="gripper_L">
        <inertial>
            <origin xyz="0 0 -0.022" rpy="0 0 0"/>
            <mass value="0.020"/>

            <inertia
                ixx="1.56950000e-05" ixy="0" ixz="0"
                iyy="1.58466667e-05" iyz="0"
                izz="1.81666667e-07"/>
        </inertial>

        <visual>
            <origin xyz="-0.009 -0.002 -0.075" rpy="-${PI / 2} -${PI / 2} 0"/>
            <geometry>
                <mesh filename="package://manipulator_description/meshes/left_finger.STL" scale="0.0015 0.0015 0.0015"/>
            </geometry>
            <material name="black">
                <color rgba="0.1 0.1 0.1 1.0"/>
            </material>
        </visual>

        <collision>
            <origin xyz="0 0 -0.022" rpy="0 0 0"/>
            <geometry>
                <box size="0.010 0.003 0.060"/>
            </geometry>
        </collision>
    </link>

    <joint name="joint_4" type="revolute">
        <parent link="gripper_base"/>
        <child  link="gripper_L"/>

        <!-- Gripper hinge location (adjust if needed) -->
        <origin xyz="-0.010 0.003 0" rpy="0 0 0"/>

        <!-- Rotation about Y-axis -->
        <axis xyz="0 1 0"/>

        <limit lower="0" upper="1.2" effort="1.0" velocity="2.0"/>
    </joint>

    <link name="gripper_R">
        <inertial>
            <origin xyz="0 0 -0.022" rpy="0 0 0"/>
            <mass value="0.020"/>

            <inertia
                ixx="1.56950000e-05" ixy="0" ixz="0"
                iyy="1.58466667e-05" iyz="0"
                izz="1.81666667e-07"/>
        </inertial>

        <visual>
            <origin xyz="-0.011 -0.002 -0.075" rpy="-${PI / 2} -${PI / 2} 0"/>
            <geometry>
                <mesh filename="package://manipulator_description/meshes/right_finger.STL" scale="0.0015 0.0015 0.0015"/>
            </geometry>
            <material name="black">
                <color rgba="0.1 0.1 0.1 1.0"/>
            </material>
        </visual>

        <collision>
            <origin xyz="0 0 -0.022" rpy="0 0 0"/>
            <geometry>
                <box size="0.010 0.003 0.060"/>
            </geometry>
        </collision>
    </link>

    <joint name="joint_5" type="revolute">
        <parent link="gripper_base"/>
        <child  link="gripper_R"/>

        <!-- Gripper hinge location (adjust if needed) -->
        <origin xyz="0.010 0.003 0" rpy="0 0 0"/>

        <!-- Rotation about Y-axis -->
        <axis xyz="0 1 0"/>

        <limit lower="-1.2" upper="0" effort="1.0" velocity="2.0"/>
        <mimic joint="joint_4" multiplier="-1"/>
    </joint>

    
</robot>
