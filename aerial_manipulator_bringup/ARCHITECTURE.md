# Aerial Manipulator System Architecture

## Directory Structure

```
rl-aerial-manipulator/
â”‚
â”œâ”€â”€ hexacopter_description/              ğŸš HEXACOPTER PACKAGE
â”‚   â”œâ”€â”€ custom_hexa/
â”‚   â”‚   â”œâ”€â”€ model.sdf                    â† Drone model (includes base_link)
â”‚   â”‚   â””â”€â”€ model.urdf
â”‚   â”œâ”€â”€ worlds/
â”‚   â”‚   â””â”€â”€ custom_hexa_world.sdf
â”‚   â””â”€â”€ launch_sitl.sh                   â† Test drone alone
â”‚
â”œâ”€â”€ Manipulator/                          ğŸ¦¾ MANIPULATOR PACKAGE  
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ manipulator_description/
â”‚   â”‚   â”‚   â”œâ”€â”€ urdf/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ manipulator.urdf.xacro  â† Arm model (starts with base_plate)
â”‚   â”‚   â”‚   â””â”€â”€ sdf/
â”‚   â”‚   â”‚       â””â”€â”€ manipulator.sdf         â† Generated by convert script
â”‚   â”‚   â”œâ”€â”€ manipulator_controller/
â”‚   â”‚   â””â”€â”€ manipulator_moveit/
â”‚   â””â”€â”€ launch_gazebo.sh                 â† Test arm alone
â”‚
â””â”€â”€ aerial_manipulator_bringup/           ğŸ¤ INTEGRATION PACKAGE (NEW!)
    â”œâ”€â”€ worlds/
    â”‚   â””â”€â”€ hexa_with_arm.sdf            â† Combined world + fixed joint
    â”œâ”€â”€ launch/
    â”‚   â””â”€â”€ sim_bringup.launch.py        â† Launch everything together
    â”œâ”€â”€ convert_urdf_to_sdf.sh           â† Setup helper script
    â”œâ”€â”€ QUICKSTART.md                    â† Quick reference
    â””â”€â”€ README.md                        â† Full documentation
```

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GAZEBO WORLD                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  hexa_with_arm.sdf                          â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚ â”‚
â”‚  â”‚   â”‚   HEXACOPTER     â”‚                                     â”‚ â”‚
â”‚  â”‚   â”‚   model.sdf      â”‚                                     â”‚ â”‚
â”‚  â”‚   â”‚                  â”‚                                     â”‚ â”‚
â”‚  â”‚   â”‚   [base_link]â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚  â”‚   â”‚    (drone body)  â”‚         â”‚                          â”‚ â”‚
â”‚  â”‚   â”‚   6 motors       â”‚         â”‚ Fixed Joint              â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ (hexa_arm_fixed)         â”‚ â”‚
â”‚  â”‚                                â”‚                          â”‚ â”‚
â”‚  â”‚                                â–¼                          â”‚ â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚                    â”‚  MANIPULATOR     â”‚                   â”‚ â”‚
â”‚  â”‚                    â”‚  manipulator.sdf â”‚                   â”‚ â”‚
â”‚  â”‚                    â”‚                  â”‚                   â”‚ â”‚
â”‚  â”‚                    â”‚  [base_plate]â”€â”€â”€â”€â”¼â”€â”                â”‚ â”‚
â”‚  â”‚                    â”‚   (arm base)     â”‚ â”‚                â”‚ â”‚
â”‚  â”‚                    â”‚  [motor_1]       â”‚ â”‚                â”‚ â”‚
â”‚  â”‚                    â”‚  [motor_2]â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€[joint_1]     â”‚ â”‚
â”‚  â”‚                    â”‚  [h_arm]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€[joint_2]     â”‚ â”‚
â”‚  â”‚                    â”‚  [motor_3]â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€[joint_3]     â”‚ â”‚
â”‚  â”‚                    â”‚  [rod]           â”‚ â”‚                â”‚ â”‚
â”‚  â”‚                    â”‚  [gripper]â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€[joint_4,5]   â”‚ â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚ â”‚
â”‚  â”‚                                         â”‚                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚                  â”‚
â”‚           Physics: They move as ONE        â”‚                  â”‚
â”‚           object (rigidly connected)       â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         ROS 2 TF TREE                   â”‚
                    â”‚                                         â”‚
                    â”‚     [world]                             â”‚
                    â”‚        â”‚                                â”‚
                    â”‚        â”œâ”€â”€[base_link]  (from Gazebo/PX4)â”‚
                    â”‚        â”‚      â”‚                         â”‚
                    â”‚        â”‚      â””â”€â”€[base_plate] (static)  â”‚
                    â”‚        â”‚             â”‚                  â”‚
                    â”‚        â”‚             â”œâ”€â”€[motor_1]       â”‚
                    â”‚        â”‚             â”œâ”€â”€[motor_2]       â”‚
                    â”‚        â”‚             â”‚   â””â”€â”€[h_arm]     â”‚
                    â”‚        â”‚             â”‚      â””â”€â”€[motor_3]â”‚
                    â”‚        â”‚             â”‚         â””â”€â”€[rod] â”‚
                    â”‚        â”‚             â”‚            â””â”€â”€...â”‚
                    â”‚        â”‚             â”‚                  â”‚
                    â”‚        â”‚         (from robot_state_pub) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        ROS 2 NODES                      â”‚
        â”‚                                         â”‚
        â”‚  â€¢ static_transform_publisher           â”‚
        â”‚    â””â”€> publishes base_link â†’ base_plateâ”‚
        â”‚                                         â”‚
        â”‚  â€¢ robot_state_publisher                â”‚
        â”‚    â””â”€> publishes arm joint transforms  â”‚
        â”‚                                         â”‚
        â”‚  â€¢ ros_gz_bridge                        â”‚
        â”‚    â””â”€> bridges Gazebo â†” ROS topics     â”‚
        â”‚                                         â”‚
        â”‚  â€¢ controller_manager                   â”‚
        â”‚    â””â”€> manages arm joint controllers   â”‚
        â”‚                                         â”‚
        â”‚  â€¢ MoveIt2                              â”‚
        â”‚    â””â”€> plans arm motions                â”‚
        â”‚                                         â”‚
        â”‚  â€¢ PX4 (optional)                       â”‚
        â”‚    â””â”€> controls hexacopter flight       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Startup Sequence

```
1. sim_bringup.launch.py starts
   â”‚
   â”œâ”€â”€> Launch Gazebo with hexa_with_arm.sdf
   â”‚    â”‚
   â”‚    â”œâ”€â”€> Spawn hexacopter model (includes base_link)
   â”‚    â”œâ”€â”€> Spawn manipulator model (includes base_plate)
   â”‚    â””â”€â”€> Create fixed joint: base_link âŸ· base_plate
   â”‚
   â”œâ”€â”€> Start static_transform_publisher
   â”‚    â””â”€â”€> TF: base_link â†’ base_plate (matches Gazebo)
   â”‚
   â”œâ”€â”€> Start robot_state_publisher
   â”‚    â””â”€â”€> TF: base_plate â†’ all arm joints
   â”‚
   â”œâ”€â”€> Start ros_gz_bridge
   â”‚    â””â”€â”€> Bridge topics between Gazebo and ROS
   â”‚
   â”œâ”€â”€> Start controller_manager
   â”‚    â””â”€â”€> Spawn arm joint controllers
   â”‚
   â”œâ”€â”€> Start MoveIt2
   â”‚    â””â”€â”€> Motion planning for the arm
   â”‚
   â””â”€â”€> (Optional) Start PX4 SITL
        â””â”€â”€> Flight control for hexacopter
```

### Runtime Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PX4/FC    â”‚ â”€â”€position/attitudeâ”€â”€> base_link moves
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MoveIt2   â”‚ â”€â”€joint commandsâ”€â”€>    â”‚  Gazebo  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  Physics â”‚
                                       â”‚          â”‚
                  base_link + arm â—„â”€â”€â”€â”€â”¤  Fixed   â”‚
                  move together        â”‚  Joint   â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                    /joint_states published
                                             â”‚
                                             â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ robot_state_pub â”‚
                                    â”‚ + static TF     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                    TF tree updated
                                             â”‚
                                             â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  All ROS nodes  â”‚
                                    â”‚  see consistent â”‚
                                    â”‚  transforms     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Integration Points

### 1. Fixed Joint in Gazebo (Physical Connection)

**File:** `aerial_manipulator_bringup/worlds/hexa_with_arm.sdf`

```xml
<joint name="hexa_arm_fixed" type="fixed">
  <parent>hexacopter::base_link</parent>    â† Drone body
  <child>manipulator::base_plate</child>    â† Arm base
</joint>
```

**Effect:**
- Physically bolts the arm to the drone in simulation
- Arm's mass/inertia affects drone dynamics
- When drone moves, arm moves exactly with it

### 2. Static TF in ROS (Knowledge Connection)

**File:** `aerial_manipulator_bringup/launch/sim_bringup.launch.py`

```python
static_transform_publisher
  arguments=['0', '0', '-0.15', '0', '0', '0',
             'base_link', 'base_plate']
```

**Effect:**
- Tells all ROS nodes: "base_plate is 0.15m below base_link"
- MoveIt plans in correct coordinate frame
- Consistent TF tree for all nodes

### 3. Robot State Publisher (Joint States)

**Effect:**
- Publishes TF transforms for all arm joints
- Reads joint states from Gazebo
- Connects base_plate â†’ motor_1 â†’ motor_2 â†’ ... â†’ gripper

## Frame Naming Convention

| Component   | Frame Name   | Description                 |
|-------------|--------------|-----------------------------|
| Hexacopter  | base_link    | Main body of drone          |
| Manipulator | base_plate   | First link of arm (bolted)  |
| Manipulator | motor_1      | Base rotation motor         |
| Manipulator | motor_2      | Shoulder pitch motor        |
| Manipulator | h_arm        | Main arm link               |
| Manipulator | motor_3      | Elbow pitch motor           |
| Manipulator | gripper_base | Gripper mounting plate      |
| Manipulator | gripper_L/R  | Left/right gripper fingers  |

## Coordinate System

```
         Z (up)
         â”‚
         â”‚
         â”‚
         â””â”€â”€â”€â”€â”€â”€ Y
        â•±
       â•±
      X

Hexacopter pose: [0, 0, 1, 0, 0, 0]  (1m above ground)
Manipulator offset: [0, 0, -0.15, 0, 0, 0]  (15cm below drone)
Actual arm position: [0, 0, 0.85, 0, 0, 0]  (85cm above ground)
```

## Testing Strategy

### Level 1: Individual Components âœ…
- Test hexacopter alone
- Test manipulator alone

### Level 2: Static Integration
- Load both in Gazebo with fixed joint
- Verify TF tree structure
- Check that they move together

### Level 3: Dynamic Integration  
- Fly hexacopter with arm attached
- Verify stability
- Move arm while hovering

### Level 4: Coordinated Control
- Plan arm motion with MoveIt
- Execute while flying
- Test grasp operations

## Configuration Files

### World File: `hexa_with_arm.sdf`
- Defines Gazebo world
- Includes both models
- Creates fixed joint

### Launch File: `sim_bringup.launch.py`
- Starts all ROS nodes
- Configures bridges
- Sets up TF tree

### URDF: `manipulator.urdf.xacro`
- Describes arm kinematics
- Used by robot_state_publisher
- Used by MoveIt for planning

### SDF: `manipulator.sdf`
- Gazebo simulation model
- Generated from URDF
- Includes physics properties

## Troubleshooting

| Issue | Check | Fix |
|-------|-------|-----|
| Models don't appear | Paths in world file | Use absolute paths |
| TF tree broken | Frame names | Verify base_link and base_plate |
| Arm doesn't move with drone | Fixed joint | Check parent/child names |
| Controllers not working | ros2_control config | Source workspace |
| MoveIt planning fails | SRDF configuration | Check planning group |

---

See `QUICKSTART.md` for step-by-step setup instructions.
See `README.md` for detailed documentation.
