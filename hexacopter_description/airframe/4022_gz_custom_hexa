#!/bin/sh
#
# @name Custom Hexarotor X
# @type Hexarotor x
#

. ${R}etc/init.d/rc.mc_defaults

# Gazebo configuration
PX4_SIMULATOR=${PX4_SIMULATOR:=gz}
PX4_GZ_WORLD=${PX4_GZ_WORLD:=custom_hexa_world}
PX4_SIM_MODEL=${PX4_SIM_MODEL:=custom_hexa}

# Enable Gazebo
param set-default SIM_GZ_EN 1

# Airframe type
param set-default CA_AIRFRAME 0
param set-default CA_ROTOR_COUNT 6
param set-default SYS_AUTOSTART 6012

# Motor positions (Gazebo ENU coordinates: X forward, Y left, Z up)
# PX4 uses FRD (X forward, Y right, Z down), so Y-axis is negated
# Motor 0: Back Left (rotor_0 in SDF at X=-0.255691, Y=0.1475) - CW → NEGATIVE KM
param set-default CA_ROTOR0_PX -0.255691
param set-default CA_ROTOR0_PY -0.1475
param set-default CA_ROTOR0_KM -0.0168

# Motor 1: Front Right (rotor_1 in SDF at X=0.255691, Y=-0.1475) - CCW → POSITIVE KM
param set-default CA_ROTOR1_PX 0.255691
param set-default CA_ROTOR1_PY 0.1475
param set-default CA_ROTOR1_KM 0.0168

# Motor 2: Back Right (rotor_2 in SDF at X=-0.255691, Y=-0.1475) - CCW → POSITIVE KM
param set-default CA_ROTOR2_PX -0.255691
param set-default CA_ROTOR2_PY 0.1475
param set-default CA_ROTOR2_KM 0.0168

# Motor 3: Front Left (rotor_3 in SDF at X=0.255691, Y=0.1475) - CW → NEGATIVE KM
param set-default CA_ROTOR3_PX 0.255691
param set-default CA_ROTOR3_PY -0.1475
param set-default CA_ROTOR3_KM -0.0168

# Motor 4: Left Center (rotor_4 in SDF at X=0, Y=0.295) - CCW → POSITIVE KM
param set-default CA_ROTOR4_PX 0.0
param set-default CA_ROTOR4_PY -0.295
param set-default CA_ROTOR4_KM 0.0168

# Motor 5: Right Center (rotor_5 in SDF at X=0, Y=-0.295) - CW → NEGATIVE KM
param set-default CA_ROTOR5_PX 0.0
param set-default CA_ROTOR5_PY 0.295
param set-default CA_ROTOR5_KM -0.0168

# Gazebo actuator mapping
param set-default SIM_GZ_EC_FUNC1 101
param set-default SIM_GZ_EC_FUNC2 102
param set-default SIM_GZ_EC_FUNC3 103
param set-default SIM_GZ_EC_FUNC4 104
param set-default SIM_GZ_EC_FUNC5 105
param set-default SIM_GZ_EC_FUNC6 106

# Motor speed limits (rad/s for your motors)
param set-default SIM_GZ_EC_MIN1 150
param set-default SIM_GZ_EC_MIN2 150
param set-default SIM_GZ_EC_MIN3 150
param set-default SIM_GZ_EC_MIN4 150
param set-default SIM_GZ_EC_MIN5 150
param set-default SIM_GZ_EC_MIN6 150

param set-default SIM_GZ_EC_MAX1 820
param set-default SIM_GZ_EC_MAX2 820
param set-default SIM_GZ_EC_MAX3 820
param set-default SIM_GZ_EC_MAX4 820
param set-default SIM_GZ_EC_MAX5 820
param set-default SIM_GZ_EC_MAX6 820

# Flight tuning - Baseline controller for RL residual learning
param set-default MC_AIRMODE 1
param set-default MPC_THR_HOVER 0.46
param set-default MPC_MANTHR_MIN 0.08

# Rate control gains - Baseline PID for residual RL to build upon
param set-default MC_ROLLRATE_P 0.15
param set-default MC_PITCHRATE_P 0.15
param set-default MC_YAWRATE_P 0.2

param set-default MC_ROLLRATE_I 0.2
param set-default MC_PITCHRATE_I 0.2
param set-default MC_YAWRATE_I 0.1

param set-default MC_ROLLRATE_D 0.003
param set-default MC_PITCHRATE_D 0.003
param set-default MC_YAWRATE_D 0.0

# Attitude control
param set-default MC_ROLL_P 6.5
param set-default MC_PITCH_P 6.5
param set-default MC_YAW_P 2.8

# EKF2 settings
param set-default EKF2_HGT_REF 1

# RL Training - Disable failsafes that could interrupt learning
#param set-default COM_ARM_WO_GPS 1
#param set-default COM_RC_LOSS_T 0
#param set-default COM_RCL_EXCEPT 4
#param set-default COM_OF_LOSS_T 1.0
#param set-default CBRK_USB_CHK 197848
